extends layout

block content
  div#player
  div#arrow
    a()#intobutton &larr;
  div#metadata
    div#titlearea
      h1= asset.title
    ul
      li.youtube
        a(href='http://www.youtube.com/watch?v=' + asset.video_id) Source
      li.gimmebar
        a(href='http://gim.ie/' + asset.short_url_token) gim.ie/#{asset.short_url_token}
      li.user
        a(href='https://gimmebar.com/loves/' + username) #{username}
      if (typeof(collection_slug) != 'undefined')
        li.gimmebar
          a(href='#') Collection
  div#footer
    div#user  
      a(href='https://gimmebar.com/loves/' + username)
        img(src="https://pro.gimmebar.com/img/avatar/" + username, height="30px", width="30px") 
        | #{username}
    div#source.metadataimages
      a(href='http://www.youtube.com/watch?v=' + asset.video_id) 
        img(src="http://localhost:3000/images/source14.png")
        | Source
    div#shortlink.metadataimages
      a(href='http://gim.ie/' + asset.short_url_token) 
        img(src="http://localhost:3000/images/gimmebar14.png")
        | gim.ie/#{asset.short_url_token}
    div#collection.metadataimages
      a(href='#')
        img(src="http://localhost:3000/images/gimmebar14.png")
        | Collection
  div#footer-bg


  script('text/javascript')
    //Loading player api asynchronously.
    //Code from Youtube.com:
    var tag = document.createElement('script');
    tag.src = "http://www.youtube.com/player_api";
    var firstScriptTag = document.getElementsByTagName('script')[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
    var done = false;
    var player;
    function onYouTubePlayerAPIReady() {
        player = new YT.Player('player', {
          height: '100%',
          width: '100%',
          videoId: '#{asset.video_id}',
          playerVars: {
            'controls': 0, 
            'showinfo': 0
          },
          events: {
            'onReady': onPlayerReady,
            'onStateChange': onPlayerStateChange
          }
        });
    }
    function onPlayerReady(evt) {
        evt.target.playVideo();
    }
    function onPlayerStateChange(newState) {
      console.log(newState.data)
        if (newState.data === 0) {
          window.location.href = '';
        }
    }
    function stopVideo() {
        player.stopVideo();
    }

